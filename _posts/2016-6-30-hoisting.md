---
layout: post
title:  "为什么 hoisting ?"
date:   2016-6-30 8:00:00
categories: javascript
---

离开饿了么已经三个月了，结婚、旅行、看朋友、打造新窝……忙忙碌碌也完成了不少预定计划。正事倒是放下了太久，计划学习 SICP 失败，计划写个 web 应用失败……这么久没碰真刀真枪，昨天就战战兢兢去面试了，结果也比较遗憾。

虽然是我的锅（本来我在学术上就没花太多功夫，设计模式？啥？），但我不服啊。

私有属性这个词就在嘴边却咬不着，结果硬是说成 “一个东西不用我提供的接口就很难访问到…”。

很多问题也都是急着比划这样做那样做再这样做，成了！然后对面一脸懵逼状，说到 “书，还是要读的……”。

<br>

哈库呐玛塔塔！书已经在运途中了。

我意识到我极大的问题是没有形成自己的知识体系，记忆宫殿……在我这里是个记忆矿场。我需要书的目录，把他画成思维导图，然后钩钩圈圈，这里不太熟，而这里我经常经常用，这里再看看……

<br>

哦！变量提升（hoisting）！学霸的最爱！送分题！可是我已经把我的背后抛到过去……大概有半年以上的时间里，我都没在用 var 了。我说当我需要变量提升特性的时候再用！结果完全不记得这档子事了啊！

我知道我需要知道为什么我要本能地避免这个特性。所以我才又想起我的 blog 了，记下来就算是我的了吧。

那么为什么要有变量提升？为什么要设计这么一个近乎缺陷的特性出来？如果你试着搜索 “为什么变量提升”，你会在首页看到

> “……<i>为什么</i>会这样呢?因为<i>变量提升</i>了！……”<br>
> “……<i>为什么</i>会报错？<i>变量提升</i>在作怪……”<br>
> “……<i>为什么</i> a 是 2？<i>变量提升</i>……”

也许中文用得不对，也可能这就是看书和用互联网解决问题的区别，或者原来这么多人都在讲面试题……

<br>

MDN 说：

> 变量提升是JavaScript将声明移至作用域 scope (全局域或者当前函数作用域) 顶部的行为。<br>
> 这意味着你可以在声明一个函数或变量之前引用它，或者可以说：一个变量或函数可以在它被引用之后声明。

这里的陷阱是，如果用 var 来声明赋值一个变量，提升的只是声明而没有赋值。而 function 整个函数体都会被提升。

```javascript
console.log(val); // undefined
var val = 1;

fun() // Why? Because I'm HERE!
function fun() {
  console.log('Why? Because I\'m HERE!');
}
```

然后，当你需要一个局部变量，语句块例如 if、for 是没用的，需要额外创建作用域。

```javascript
// var i; 这里被提升了
for (var i = 1; i <= 2; i++) {
  // ...
}
console.log(i); // 3
```

我更愿意相信这个特性就是缺陷，现在（ES6）想要语句块中的局部变量只要用 let 或 const 就可以了。自己在近一段时间的实际项目中尝试只用 const，可变量是万恶之源么。

有那么一段时间很喜欢利用 function 的 hoisting 特性，觉得主逻辑写在前面，细节的东西就像脚注一样写在后面可以按图索骥，现在看来是没什么意义……

也看到过同伴使用 hoisting 特性来实现某个逻辑，但是在比较极端的代码压缩方式下出了问题。这在大型项目里还是不容易 debug 的，我知道你肯定不愿意让事情变得越来越麻烦。
